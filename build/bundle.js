!function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t){e.appendChild(t)}function l(e){e.parentNode.removeChild(e)}function a(e){return document.createElement(e)}function s(e){return document.createTextNode(e)}function u(){return s(" ")}function f(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function d(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function g(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function h(e,t){e.value=null==t?"":t}function b(e,t,n,o){e.style.setProperty(t,n,o?"important":"")}let m;function _(e){m=e}const p=[],w=[],y=[],x=[],$=Promise.resolve();let v=!1;function k(e){y.push(e)}let R=!1;const A=new Set;function C(){if(!R){R=!0;do{for(let e=0;e<p.length;e+=1){const t=p[e];_(t),E(t.$$)}for(_(null),p.length=0;w.length;)w.pop()();for(let e=0;e<y.length;e+=1){const t=y[e];A.has(t)||(A.add(t),t())}y.length=0}while(p.length);for(;x.length;)x.pop()();v=!1,R=!1,A.clear()}}function E(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(k)}}const I=new Set;function S(e,t){-1===e.$$.dirty[0]&&(p.push(e),v||(v=!0,$.then(C)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function L(i,c,a,s,u,f,d=[-1]){const g=m;_(i);const h=i.$$={fragment:null,ctx:null,props:f,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(g?g.$$.context:[]),callbacks:n(),dirty:d,skip_bound:!1};let b=!1;if(h.ctx=a?a(i,c.props||{},((e,t,...n)=>{const o=n.length?n[0]:t;return h.ctx&&u(h.ctx[e],h.ctx[e]=o)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](o),b&&S(i,e)),t})):[],h.update(),b=!0,o(h.before_update),h.fragment=!!s&&s(h.ctx),c.target){if(c.hydrate){const e=function(e){return Array.from(e.childNodes)}(c.target);h.fragment&&h.fragment.l(e),e.forEach(l)}else h.fragment&&h.fragment.c();c.intro&&((p=i.$$.fragment)&&p.i&&(I.delete(p),p.i(w))),function(e,n,i,c){const{fragment:l,on_mount:a,on_destroy:s,after_update:u}=e.$$;l&&l.m(n,i),c||k((()=>{const n=a.map(t).filter(r);s?s.push(...n):o(n),e.$$.on_mount=[]})),u.forEach(k)}(i,c.target,c.anchor,c.customElement),C()}var p,w;_(g)}function T(t){let n,r,i,m,_,p,w,y,x,$,v,k,R,A,C,E,I,S,L,T,W,P,U,j,q,z,B,M,O,N,D,H,F,J,Y,X;return{c(){n=a("main"),r=a("div"),i=a("input"),m=u(),_=a("div"),p=a("canvas"),w=u(),y=a("div"),x=a("button"),x.textContent="ANALYZE PICTURE",$=u(),v=a("h2"),k=s("Count: "),R=s(t[1]),A=a("br"),C=s("Dominoes Found: "),E=s(t[4]),I=u(),S=a("h3"),S.textContent="Settings:",L=u(),T=a("div"),W=a("label"),P=a("input"),U=s("\r\n\r\n      Resize images? (Bigger image = better results, slower analyzing)"),j=u(),q=a("label"),z=a("input"),B=u(),M=a("body"),O=s(t[3]),N=s(" times screen width or height"),D=u(),H=a("h2"),H.innerHTML="Instructions:<br/>",F=u(),J=a("p"),J.innerHTML="1. Arrange the dominoes in a single file vertical line<br/>\n    2. Click on the &quot;Browse...&quot; button to and take a photo of the dominoes from directly\n    above<br/>\n    3. Tap on the top left and top right corner of the line of dominoes to crop the\n    image (you don&#39;t have to be too precise)<br/>\n    4. Click the &quot;Analyze&quot; button",d(i,"type","file"),d(i,"accept","image/*"),d(_,"class","container"),d(P,"type","checkbox"),d(z,"type","range"),d(z,"step","0.1"),d(z,"min","0.1"),d(z,"max","2.0"),b(H,"text-align","left"),b(J,"text-align","left"),d(n,"class","svelte-1e9puaw")},m(e,o){!function(e,t,n){e.insertBefore(t,n||null)}(e,n,o),c(n,r),c(r,i),t[13](i),c(n,m),c(n,_),c(_,p),t[14](p),c(n,w),c(n,y),c(y,x),c(y,$),c(y,v),c(v,k),c(v,R),c(v,A),c(v,C),c(v,E),c(n,I),c(n,S),c(n,L),c(n,T),c(T,W),c(W,P),P.checked=t[2],c(W,U),c(T,j),c(T,q),c(q,z),h(z,t[3]),c(q,B),c(q,M),c(M,O),c(M,N),c(n,D),c(n,H),c(n,F),c(n,J),Y||(X=[f(i,"change",t[12]),f(p,"click",t[8]),f(x,"click",t[9]),f(P,"change",t[15]),f(P,"click",t[6]),f(z,"change",t[16]),f(z,"input",t[16]),f(z,"change",t[7])],Y=!0)},p(e,[t]){2&t&&g(R,e[1]),16&t&&g(E,e[4]),4&t&&(P.checked=e[2]),8&t&&h(z,e[3]),8&t&&g(O,e[3])},i:e,o:e,d(e){e&&l(n),t[13](null),t[14](null),Y=!1,o(X)}}}function W(e,t,n){let o,r,{count_dominoes:i}=t,c=null,l=0,a=!1,s=1,u="Please upload photo",f=[],d=null,g=0,h=0,b=null;function m(e){let t,i=s;t=null!=e?e:o,console.log("redrawing:"),console.log("settings:","\nratio:",i),console.log(t),console.log("redrawing"),console.log(`image: ${t}`);var c=r.getContext("2d");c.clearRect(0,0,r.width,r.height),1==a||(i=1),n(5,r.width=t.width*i,r),n(5,r.height=t.height*i,r),c.drawImage(t,0,0,t.width,t.height,0,0,t.width*i,t.height*i)}const _=e=>{var t=r.getContext("2d"),n=new FileReader;n.onload=function(e){var n=new Image;n.onload=function(){o=n,console.log(r),console.log(`${n.naturalHeight}, ${n.naturalWidth}`),console.log("Image set. Ready to analyze.");var e=t.getImageData(0,0,n.width,n.height);d=e.data,h=n.width,g=n.height,m(n)},n.src=e.target.result,m(n)},n.readAsDataURL(e.target.files[0])};return e.$$set=e=>{"count_dominoes"in e&&n(11,i=e.count_dominoes)},[c,l,a,s,u,r,function(){console.log("Resize button old:",a),n(2,a=1!=a),console.log("Resize button new:",a),m()},function(){m()},function(e){console.log(r.getBoundingClientRect());let t=r.getBoundingClientRect();var n=r.getContext("2d");n.clearRect(0,0,r.width,r.height),m();let o,i,c=e.clientX-t.left,l=e.clientY-t.top;f.push({x:c,y:l}),f.length>2&&f.shift(),f.forEach((e=>{console.log(e.x),console.log(e.y),n.fillStyle="#3aeb34",n.beginPath(),n.arc(e.x,e.y,5,0,2*Math.PI),n.fill()})),2==f.length&&(f[0].x<f[1].x?(o=f[0],i=f[1]):(o=f[1],i=f[0]),n.strokeStyle="green",n.lineWidth=5,n.shadowColor="#d53",b={x:o.x,y:o.y,x_len:i.x-o.x,y_len:i.y-o.y},n.strokeRect(b.x,b.y,b.x_len,b.y_len)),console.log("domino image section (JS)"),console.log(b),console.log(`${c}, ${l}`)},function(e){let t;if(console.log("onSubmitPicture"),n(4,u="waiting..."),null!=d){if(null!=b){var o=r.getContext("2d").getImageData(b.x,b.y,b.x_len,b.y_len).data;console.log("domino image section (JS)"),console.log(b),t=i(o,b.x_len,b.y_len,!0)}else t=i(d,h,g,!1);console.log("Results of count:"),n(1,l=t.value),console.log(t),n(4,u=t.string_rep),console.log("after return")}else alert("No picture uploaded yet.")},_,i,e=>_(e),function(e){w[e?"unshift":"push"]((()=>{c=e,n(0,c)}))},function(e){w[e?"unshift":"push"]((()=>{r=e,n(5,r)}))},function(){a=this.checked,n(2,a)},function(){var e;e=this.value,s=""===e?null:+e,n(3,s)}]}class P extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),L(this,e,W,T,i,{count_dominoes:11})}}let U,j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});j.decode();let q=null;function z(){return null!==q&&q.buffer===U.memory.buffer||(q=new Uint8Array(U.memory.buffer)),q}function B(e,t){return j.decode(z().subarray(e,e+t))}const M=new Array(32).fill(void 0);M.push(void 0,null,!0,!1);let O=M.length;function N(e){O===M.length&&M.push(M.length+1);const t=O;return O=M[t],M[t]=e,t}function D(e){return M[e]}function H(e){const t=D(e);return function(e){e<36||(M[e]=O,O=e)}(e),t}let F=0;let J=new TextEncoder("utf-8");const Y="function"==typeof J.encodeInto?function(e,t){return J.encodeInto(e,t)}:function(e,t){const n=J.encode(e);return t.set(n),{read:e.length,written:n.length}};let X=null;function Z(){return null!==X&&X.buffer===U.memory.buffer||(X=new Int32Array(U.memory.buffer)),X}async function G(e){void 0===e&&(e=new URL("index_bg.wasm",document.currentScript&&document.currentScript.src||new URL("bundle.js",document.baseURI).href));const t={wbg:{}};t.wbg.__wbindgen_string_new=function(e,t){return N(B(e,t))},t.wbg.__wbindgen_object_drop_ref=function(e){H(e)},t.wbg.__wbindgen_json_parse=function(e,t){return N(JSON.parse(B(e,t)))},t.wbg.__wbg_new_59cb74e423758ede=function(){return N(new Error)},t.wbg.__wbg_stack_558ba5917b466edd=function(e,t){var n=function(e,t,n){if(void 0===n){const n=J.encode(e),o=t(n.length);return z().subarray(o,o+n.length).set(n),F=n.length,o}let o=e.length,r=t(o);const i=z();let c=0;for(;c<o;c++){const t=e.charCodeAt(c);if(t>127)break;i[r+c]=t}if(c!==o){0!==c&&(e=e.slice(c)),r=n(r,o,o=c+3*e.length);const t=z().subarray(r+c,r+o);c+=Y(e,t).written}return F=c,r}(D(t).stack,U.__wbindgen_malloc,U.__wbindgen_realloc),o=F;Z()[e/4+1]=o,Z()[e/4+0]=n},t.wbg.__wbg_error_4bb6c2a97407129a=function(e,t){try{console.error(B(e,t))}finally{U.__wbindgen_free(e,t)}},t.wbg.__wbg_log_386a8115a84a780d=function(e){console.log(D(e))},t.wbg.__wbindgen_throw=function(e,t){throw new Error(B(e,t))},("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return U=n.exports,G.__wbindgen_wasm_module=o,U}var K=Object.freeze({__proto__:null,count_dominoes_from_base64:function(e,t,n,o){var r=function(e,t){const n=t(1*e.length);return z().set(e,n/1),F=e.length,n}(e,U.__wbindgen_malloc),i=F;return H(U.count_dominoes_from_base64(r,i,t,n,o))},default:G});(async()=>{const e=await(async(e={})=>{let{importHook:t,serverPath:n}=e,o="build/assets/domino-counter-227c161a.wasm";return null!=n&&(o=n+/[^\/\\]*$/.exec(o)[0]),null!=t&&(o=t(o)),await G(o),K})();new P({target:document.body,props:{count_dominoes:e.count_dominoes_from_base64}})})()}();
//# sourceMappingURL=bundle.js.map
